#!/bin/bash

set -eo pipefail

temp=$(mktemp /tmp/provisioning-manifest-<%= manifest.uuid %>.XXXXXXXX)

rmtemp() {
  rm "$temp"
}

main() {
  gem install provisioning

  curl -s "<%= manifest_url(protocol: :https, format: :json) %>" > "$temp"

  provision "$temp"
}

trap rmtemp EXIT

main
